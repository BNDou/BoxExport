<!--
 * @FilePath     : /BoxExport/README.md
 * @Description  :  
 * @Author       : BNDou
 * @Date         : 2025-10-28 22:06:47
 * @LastEditTime : 2025-10-28 23:02:51
-->
# BoxExport 病案卷内目录批量生成工具

## 背景
档案局在接收医院病案室已归档且电子成像的旧病历时，需要病案室提供每个装箱病案的详细清单，而且对清单格式有明确要求。传统做法需要手工整理、复制粘贴、调整格式，工作量大、容易出错。该工具使用 Python 批量处理，自动从同结构的 Excel 源表读取数据，按要求生成对应的清单，显著降低工作量与出错率。

## 功能概述
- 图形界面（Tkinter），窗口固定在屏幕左上角 (0,0)。
- 选择数据源文件夹（如 `data/`），其中包含多个 `.XLS` 文件，结构一致。
- 自定义导出目录（可通过“打开导出目录”按钮在资源管理器中查看）。
- 为每个源文件生成一份对应的清单 `.xlsx` 到所选导出目录。
- 清单格式自动设置：标题、合并单元格、字体字号、行高、列宽、边框等。
- 读取列：病案号、出院科室、患者姓名、出院时间、入院时间、成像张数。
- 支持“顺序号”连续编号：首次运行需输入起始值，之后按文件顺序递增。
- 实时进度：进度条、百分比、当前文件、每文件耗时、平均耗时、ETA。
- 支持“停止”按钮：点击后会在当前文件处理完成后终止后续文件。

## 环境与依赖
- Python 3.8+（Windows 10 测试通过）
- 依赖包：
  - xlrd==1.2.0（读取 .xls）
  - openpyxl（生成 .xlsx）

安装依赖：
```bash
pip install xlrd==1.2.0 openpyxl
```

## 使用步骤
1. 运行 `BoxExport.py`（启动 GUI）。
2. 选择“数据目录”（建议为项目下的 `data/`）。
3. 设置“导出目录”（可点击“打开导出目录”按钮直接查看）。
4. 输入“起始顺序号”（如首次为 1；若承接上一批，请输入上次最后一个顺序号+1）。
5. 点击“开始”，等待进度完成（界面显示当前文件、耗时与 ETA）。
6. 如需中止，点击“停止”（会在当前文件完成后停止后续处理）。
7. 处理完成后，生成的 `.xlsx` 在所选“导出目录”。

## 源数据格式要求（.XLS）
- 表结构统一，取值列（以列字母说明）：
  - A：归档号（不导出）
  - C：病案号
  - D：出院科室
  - E：患者姓名
  - F：出院时间
  - G：入院时间
  - H：成像张数
  - I：备注（不导出，但目标表保留备注列）
- 默认从第3行起为数据行（第2行为表头）。

## 导出清单格式（.xlsx）
- A1-H1 合并，内容“卷内目录”，宋体 20 号，加粗，行高 25。
- E2“全宗号”、F2“120”、G2“类目”、H2“BL”，宋体 16 号，行高 25。
- G3“箱号”、H3为文件名对应的箱号（去掉前导 0），宋体 16 号，行高 25。
- 第4行表头（A-H）：
  - A“顺序号”（数据列居中显示）
  - B“病案号”
  - C“出院科室”
  - D“患者姓名”
  - E“出院时间”
  - F“入院时间”
  - G“成像张数”（数据列居中）
  - H“备注”（保留，不自动填）
- 列宽：A/D/G=8，B=11，C=13，E/F=10，H=15。
- 整表（A1 到 H最后行）添加细边框。

## 常见问题
- 无法读取 .xls：确保安装 `xlrd==1.2.0`（新版 xlrd 不再支持 .xls）。
- 日期显示为数字：源表日期被当作数值时，程序会尽量转为日期并在导出表中设置 `yyyy-mm-dd`。
- 顺序号从哪里开始：首次运行由用户输入；若需承接历史批次，可以输入上次最后一个顺序号+1。

## 目录结构示例
```
BoxExport/
  BoxExport.py
  README.md
  data/
    000013.XLS
    000014.XLS
    ...
  （导出目录可自定义，示例：D:/Exports/BoxExport/...）
```

## 许可
内部办公自动化脚本，如需外发请根据单位规范处理。
